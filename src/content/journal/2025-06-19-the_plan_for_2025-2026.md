---
title: "The plan"
date: 2025-05-19
draft: true
author: "Julien Taquet"
class:
intro: "Paged.js future — a table of content"
---
The people in charge of maintaining paged.js these days are Julien Taquet (julientaq), Fred Chasen et Gjis de Heis. 
 
Fred Chasen, 
Gjis de Heis,
1. team changes
2. support and sponsoring changes
3. paged.js changes
In short, if you’re using chrome 131, and defined @margin-boxes in the css, then paged.js will use them, and chrome too. 
This is litterally a framework to design for print inside the browser.
Which means that we can actually try things that people never did before in CSS print: check the amount of space left on the page before adding an element to it, have one full page image that bleeds on the right page, or even have multiple flows. The sort of things book designers have been making for centuries were now available. But there is an issue: there are no specifications for those things in the documentation of the w3c. The idea of facing pages doesn’t exist. Which means that paged.js can’t support it without taking the risk of those features being problematic in the future. 


### Paged.js restart

## toward paged.js ~~1.0~~ 2
So let’s see what we have in mind for the future of paged.js, and the changes we want to go through.


### Modularize paged.js 
Before we get into that, we need to discuss a bit about what was the future for paged.js in our mind when we started.
specs are not good enough, paged.js can be a nice place to test specs. let’s keep it and make it better at what it does: previewing print.
Paged.js is a 3 pieces software:
1. Chunker — in charge of the fragmentation of the content, finding page break and break token
2. Polisher - in charge of all the css manipulation, converting styles for print into previewable styles. 
3. Previewer - runs orchestrate paged.js, find the stylesheets, run the content, call the chunker and the polisher as needed.
But those three pieces are intertwined in so many places that it becomes a bit of a burden to get new feature in. That’s why we decided to update paged.js to a modern modular architecture.

The second bit is that Chromium started to implement some of the features for print, starting with the margin boxes, and by doing so, paged.js is at a pivotal point. We can either change ourselve to try and get an hybrid support, where we could polyfill what the browser can’t do, but it will be painful for anything. 
1. Chunker will be its own library. Think of it as a polyfill for fragmentations, that you could call on any html element, to find what overflow, and find one or more break token. This chunker.js will be called by paged.js to find the break token between pages. 
2. We’ll introduce the `<paged-page>` and the `<paged-document>` custom HTML elements in replacement of the template literals that exist in paged.js code. Those web components will also be usable outside of paged.js. 




## Update the fragmentation method to handle multiple break tokens 
To support multiple features such as CSS grid, flex and proper table, we need to change the algorithm that paged.js uses to find page breaks, by using the intersection observer available in browsers to find the multiple breaks locations (like each cell in a table for instance). Those change will directly be made in the new fragmentation library.
We want to provide a set of web-components that build the Paged.js preview. Web-components will allow for the manipulation of paged preview as reusable elements and not as core code.
-  Set up a `&lt;paged-page&gt;` element for print preview.
-  Paged media `&lt;paged-margin-box&gt;` elements
-  `&lt;paged-area&gt;` for the fragmented content
-  Add a new `&lt;paged-document&gt;` element that will control the state of the fragmentation, and will manage the page management, kicking off fragmentation and CSS parsing when passed content. 
-  Update polyfill to transparently use custom elements when the script is added to the page. 

##  Use CSSOM for CSS parsing and manipulation.
Rather than continue to pre-process print CSS with an external library (CSSTree), we switch to using browsers’ native CSS Object Model (CSSOM) standard whenever possible.
-  replace CSSTree: implement method to walk the css, add, replace and remove rules, filter properties, find @media print features, etc. Implement queries to find elements using complex selectors
-  Update existing Paged.js handlers to use those new methods
-  Adjust for browsers that haven’t implemented CSS OM  features that Paged.js needs

##  WPT Printing test
Lucie and Guillaume at Weasyprint have implemented a tool to run the Web Platform Tests, setting up a great foundation for css print. We want to contribute to this platform by adding UX and features to run directly from browsers. 
-  Design and implement a user interface for the printing test platform
-  Support for paged.js test in different environments (browsers, pupeteer, playground, etc.)  

##  Tagged PDF support
Chromium is now able to support taggedPDF export. Paged.js needs to be updated to support this specific export. 
-  Update Paged.js to support tagged PDF output.
-  Post Processing for accessibility features not available from the browsers
-  During the project, we'll consult with a HAN accessibility expert to see where we can improve PDF output, website and doc for accessibility. Take into account their recommendations.

##  Pagedjs.org website updates
Paged.js website need an update to support automatic documentation from JSdoc and translations for articles and documentation.
-  update to the latest version of Eleventy and add mechanism to switch between languages and automatic documentation from JSDoc. (The translation of the documentation is not part of the task)

