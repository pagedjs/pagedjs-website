<!DOCTYPE html>



<html lang=" en" class="no-js">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">

<title>Paged.js — Handlers, Hooks and custom javascript</title>

<script type="module">
document
.documentElement
.classList
.remove('no-js');
document
.documentElement
.classList
.add('js');
</script>
<meta name="description" content="">
<meta property="og:title" content="Handlers, Hooks and custom javascript — ">
        <meta property="og:description" content="">
        <meta property="og:image" content="">
        <meta property="og:image:alt" content="Image description">
        <meta property="og:locale" content="en_GB">
        <meta property="og:type" content="website">
        <meta name="twitter:card" content="summary_large_image">
        <meta property="og:url" content="site.url">
        <link rel="canonical" href="https://www.mywebsite.com/page">

        <link rel="icon" href="/favicon.ico">
        <link rel="icon" href="/favicon.svg" type="image/svg+xml">
        <link rel="apple-touch-icon" href="/apple-touch-icon.png">
        <link rel="manifest" href="/my.webmanifest">
        <meta name="theme-color" content="NaN">

        
        <meta name="twitter:dnt" content="on">
        
            

        

        
            <link rel="stylesheet" href="/css/theme-pagedjs/main.css">
        

        <link href="https://unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet">
        <script>

        // if there is a dark mode in the storage, use that
        if (localStorage.getItem('Nightmode') == "true") {
        document
        .documentElement
        .classList
        .add('nightmode')
        }
        </script>

        

            <script>

  if (window.location.href.includes("?night")) {
    document.documentElement.classList.add("nightmode");
  }

function start() {

    document.querySelectorAll("a").forEach((a) => {
      if (a.href.includes(`?day`)) {
        // add the infor mation in the url of each link
        a.href = `${a.href.replace("?day", "?night")}`;
      } else if (a.href.includes("#")) {
        a.href = a.href.replace("#", "index.html?night#");
      } else {
        a.href = `${a.href}?night`;
      }
    });
};

start()
</script>

        
        </head>

        <body  class=" " style="">

        <div class="crop-marks">
    <div class="crop-mark vertical"></div>
    <div class="crop-mark horizontal"></div>
    <div class="paper"></div>
</div>

        

        
            <div class="running-head">

        
    
    <a class="back-home" href="/">
        
    <svg id="paged-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 213 52" fill="none" id="paged-logo"><path fill="var(--color-body)" d="M69.1 34.7c0 1.3-.5 2.7-1.6 2.7s-1.6-1.1-1.6-4.6v-7.1c0-7.3-1.5-13.5-12.1-13.5-6.5.0-13.4 2.2-13.4 8.4.0 4.7 6.9 6.1 9.9 2.6-1-1.3-1.7-3-1.7-4.5.0-2.9 2.2-3.5 4.4-3.5 2.4.0 3.9 1.4 3.9 8.6v1.3l-4.1 1.1c-7.9 2.2-12.9 4.9-12.9 9.1.0 3.9 2.2 6 7.1 6 4.6.0 8.7-2.4 11-7.7h.5c.9 5 2.4 7.7 6.8 7.7 3.1.0 6.6-1.5 6.1-6.7h-2.3v.1zm-17.8 1.8c-1.7.0-2.6-.9-2.6-2.1.0-3.2 2.3-4.7 8.2-6.5.1 4-2.5 8.6-5.6 8.6zM24.8 12.3c-3.6.0-9.6 1.2-10.6 9.1h-.9v-9.1L.9 15.2v2.4h6v31l-5.4.4v2.4h20.2V49l-6.2-.5V37.3c1.3 1.9 4 4.2 8.7 4.2 5.1.0 12.3-4.4 12.3-14.2.0-9.2-5.1-15-11.7-15zm-2.4 25.2c-2.8.0-5.3-1.5-6.5-5.7v-8.9c.1-1.3 1.5-5.4 5-5.4 4.4.0 7 5.1 7 10.5-.1 4.7-2 9.5-5.5 9.5zm155-21.6h5.8v32c0 3.4-4.3.4-5.1-3.1H177c-1.3 3.5-.2 6.9 3.1 6.9 3.2.0 7.4-1.7 7.4-8.9l.1-30.6-10.2 1.4v2.3zm-6 17.9c-2.4.0-3.7 1.3-3.7 3.7.0 2.4 1.3 3.7 3.7 3.7 2.4.0 3.7-1.3 3.7-3.7.0-2.4-1.4-3.7-3.7-3.7zM95.8 37.4c-4.9-1.1-12.3-1.1-15.9-1.6l1.2-2.4c1.4.4 3.1.6 5 .6 8.6.0 13.3-4.9 13.3-11.3.0-4.4-3-8-7.8-9.6l.2-.6c1.9.4 3.9.7 5.4.7 2.3.0 4-.8 4-3.4.0-1.8-1.3-4.1-3.3-6.2-3.3 3.6-6.2 7.3-10.7 8.7-.2-.1-.4-.1-.6-.1-8.6.0-13 4.8-13 11.3.0 4 1.8 7.4 5.7 9.2l-5.5 4.6c.4.8 1.7 2.9 6.5 4.4v.7c-4.4.6-7 1.9-7 3.7.0 3.8 7 5.7 12.3 5.7 9.1.0 16.6-2.3 16.9-7.9.0-3.6-1.6-5.4-6.7-6.5zm-10-22.2c3.3.0 4.8 2.4 4.8 7.4.0 5.7-1.1 8.5-4 8.5-3.4.0-4.8-2.9-4.8-8.4.1-5.3 1.2-7.5 4-7.5zm5.1 32.5c-6.2.0-10.5-1.5-10.5-3.2.0-.6.6-1.3 1.8-2.2l.9.2c9.4 1.8 14.8 1.3 14.8 3 .1 1.4-2.5 2.2-7 2.2zM199 21.5c-2.3-1.4-3.3-2.6-3.3-4 0-1.6 1.1-3.3 4-3.3 4.3.0 8.1 3.6 10.6 8.9h1.1v-8.4c-3-1.6-6.4-2.4-9.5-2.4-5.3.0-9.8 2.4-9.8 7.3.0 3.9 3.1 6.7 6.2 8.4 5.8 3.2 11 4.4 11 7.8.0 2.3-2.2 3.6-4.7 3.6-5.2.0-8.9-2.7-10.9-10.2h-1.1v9.4c2.7 1.8 6.5 2.8 10.1 2.8 5.4.0 10.2-2.2 10.2-7.7.1-6.5-7.5-8.3-13.9-12.2zM185.7 1.8c-2 0-2.9 1.1-2.9 2.9.0 1.9 1 2.9 2.9 2.9 1.8.0 2.9-1 2.9-2.9s-1.1-2.9-2.9-2.9zM126.1 29.1c.1.4.1.7.1 1.1.0 3.9-2.8 6.1-6.8 6.1-3.9.0-6.7-2.8-7.7-8.5l17.2-4.3c-.2-7.7-4.7-11.3-12.9-11.3-6.2.0-13 4.5-13 14.4.0 7.5 4.9 14.6 13.9 14.6 8 0 12.3-5.3 12.3-11.2.0-.5-.1-1-.1-1.5l-3 .6zm-14.7-5.8c0-5.2 2.2-8 5.3-8 2.9.0 3.8 3.2 3.8 5.6.0 1.5-1.9 1.8-5.1 2.9l-4 1.3v-1.8zM147 4.7l6.2.5v10.6c-1.5-2.1-4-3.6-8.4-3.6-5.1.0-12.3 4.4-12.3 14.2.0 9.1 5.1 14.9 11.7 14.9 3.6.0 9.6-1.2 10.6-9.1h1l1.9 8.3h4V.8l-14.8 1.5v2.4h.1zm6.2 26c-.1 1.2-1.1 5.4-5.9 5.4-4 0-6-4.9-6-10.5.0-4.7 1.9-9.5 5.4-9.5 2.8.0 5.3 1.5 6.5 5.7v8.9z"></path></svg>    

    </a>
    
    <button class="menu-call">MENU</button>
    <nav class="menu hide" role="main">
        <ul>

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                
                    <li  class="">
                        <a href="/about/">about</a>
                    </li>
                

            
                
                    <li  class="">
                        <a href="/frequently-asked-questions-about-paged.js.html">FAQ</a>
                    </li>
                

            
                
                    <li  class="">
                        <a href="/documentation/">documentation</a>
                    </li>
                

            
                
                    <li  class="">
                        <a href="/made-with-paged.js.html">examples</a>
                    </li>
                

            
                

            
                
                    <li  class="">
                        <a href="/posts/">journal</a>
                    </li>
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            
                

            

            <li>
                <a class="gitlab-link" href="https://gitlab.coko.foundation/pagedjs/pagedjs/">Gitlab</a>
            </li>
        </ul>
    </nav>

</div>


        

        
  


         
  
  <header>
    <h1 id="title">
        
        Handlers, Hooks and custom javascript
    </h1>
    
      <p class="meta">written 
        
        on <time class="date">1/28/2020</time>
      </p>        
    
  </header>  
  <article>
    
      <p class="intro">You’re now fluent in paged media specs, that quite awesome :). But you may want to do more with the scripts. Here is how you can update some of the script to do what you’d like to do.
        
    
    <p>Paged.js is built as a collection of module that run codes at different moments while creating the layout. This can be helpful if you want to transform long hyperlinks adresses to truncable ones before paged.js look at the content, or if you want to pass some script to balance the amount of lines your titles need once the title is put on the page.</p>
<p>To do that, we need to register a module, and define when its code should be processed.</p>
<h2 id="modules" tabindex="-1">Modules</h2>
<p>Modules are groups of handlers for that apply the layout and styles of a CSS module, such as Generated Content.</p>
<p>New handlers can be registered from <code>import { registerHandlers } from 'pagedjs'</code> or by calling <code>Paged.registerHandlers</code> on an html page.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/pagedjs/dist/paged.polyfill.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">class</span> <span class="token class-name">MyHandler</span> <span class="token keyword">extends</span> <span class="token class-name">Paged<span class="token punctuation">.</span>Handler</span> <span class="token punctuation">{</span><br>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">chunker<span class="token punctuation">,</span> polisher<span class="token punctuation">,</span> caller</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">super</span><span class="token punctuation">(</span>chunker<span class="token punctuation">,</span> polisher<span class="token punctuation">,</span> caller<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token function">afterPageLayout</span><span class="token punctuation">(</span><span class="token parameter">pageFragment<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pageFragment<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  Paged<span class="token punctuation">.</span><span class="token function">registerHandlers</span><span class="token punctuation">(</span>MyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>Handlers have methods that correspond to the hooks for the parsing, layout and rendering of the Chunker and Polisher. Returning an promise or <code>async</code> function from a method in a handler will complete that task before continuing with the other registered methods for that hook.</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Previewer</span><br><span class="token function">beforePreview</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> renderTo<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">afterPreview</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Chunker</span><br><span class="token function">beforeParsed</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">afterParsed</span><span class="token punctuation">(</span>parsed<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">beforePageLayout</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">afterPageLayout</span><span class="token punctuation">(</span>pageElement<span class="token punctuation">,</span> page<span class="token punctuation">,</span> breakToken<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">afterRendered</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Polisher</span><br><span class="token function">beforeTreeParse</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> sheet<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">beforeTreeWalk</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">afterTreeWalk</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> sheet<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">onUrl</span><span class="token punctuation">(</span>urlNode<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">onAtPage</span><span class="token punctuation">(</span>atPageNode<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">onRule</span><span class="token punctuation">(</span>ruleNode<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">onDeclaration</span><span class="token punctuation">(</span>declarationNode<span class="token punctuation">,</span> ruleNode<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">onContent</span><span class="token punctuation">(</span>contentNode<span class="token punctuation">,</span> declarationNode<span class="token punctuation">,</span> ruleNode<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Layout</span><br><span class="token function">layoutNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">renderNode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> sourceNode<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">onOverflow</span><span class="token punctuation">(</span>overflow<span class="token punctuation">,</span> rendered<span class="token punctuation">,</span> bounds<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">onBreakToken</span><span class="token punctuation">(</span>breakToken<span class="token punctuation">,</span> overflow<span class="token punctuation">,</span> rendered<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="some-informations-about-the-hooks" tabindex="-1">Some informations about the hooks</h3>
<p>Here is some information about some hooks, the documentation remains to be completed. Their execution order is not quite the same as the one presented and corresponds rather to the different modules that constitute Paged.js</p>
<h4 id="previewer" tabindex="-1">Previewer</h4>
<table>
<thead>
<tr>
<th>Hook</th>
<th style="text-align:center">Hooks order</th>
<th style="text-align:right">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>beforePreview(content, renderTo)</code></td>
<td style="text-align:center">Before pagedjs is launched [Warning : event does not trigger]</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td><code>afterPreview(pages)</code></td>
<td style="text-align:center">After PagedJS finished running (check afterRendered(pages)</td>
<td style="text-align:right"><code>pages</code> → array that contains all page nodes</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h4 id="chuncker" tabindex="-1">Chuncker</h4>
<table>
<thead>
<tr>
<th>Hook</th>
<th style="text-align:center">Hooks order</th>
<th style="text-align:right">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>beforeParsed(content)</code></td>
<td style="text-align:center">runs on content before it is parsed and given IDs</td>
<td style="text-align:right"><code>content</code> → document-fragment made from the original DOM</td>
</tr>
<tr>
<td><code>afterParsed(parsed)</code></td>
<td style="text-align:center">runs after the content has been parsed but before rendering has started</td>
<td style="text-align:right"><code>parsed</code> → content once parsed and given ids (data-ref and break rules from the css)</td>
</tr>
<tr>
<td><code>beforePageLayout(page)</code></td>
<td style="text-align:center">runs when a new page has been created</td>
<td style="text-align:right"><code>page</code> → node of the page that’s gonna be created</td>
</tr>
<tr>
<td><code>afterPageLayout(pageElement, page, breakToken)</code></td>
<td style="text-align:center">runs after a single page has gone through layout, and allows adjusting the breakToken</td>
<td style="text-align:right"><code>pageElement</code> → page element that just been rendered, <br> <code>page</code> → node of the page being rendered,<br> <code>breakToken</code> → location of the beginning of the overflow</td>
</tr>
<tr>
<td><code>afterRendered(pages)</code></td>
<td style="text-align:center">runs after all pages have finished rendering</td>
<td style="text-align:right"><code>pages</code> → array that contains all page nodes</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h4 id="polisher" tabindex="-1">Polisher</h4>
<table>
<thead>
<tr>
<th>Hook</th>
<th style="text-align:center">Hooks order</th>
<th style="text-align:right">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>beforeTreeParse(text, sheet)</code></td>
<td style="text-align:center">runs every time a style element or a link to a css file is called (worked also on @import)</td>
<td style="text-align:right"><code>text</code> → innerText of the css, <br> <code>sheet</code> → cssTree parsed object (AST object)</td>
</tr>
<tr>
<td><code>beforeTreeWalk(ast)</code></td>
<td style="text-align:center">runs before the stylesheet has been parsed by csstree</td>
<td style="text-align:right"><code>ast</code> → csstree parsed object</td>
</tr>
<tr>
<td><code>afterTreeWalk(ast, sheet)</code></td>
<td style="text-align:center">runs after the stylesheet has been parsed by csstree</td>
<td style="text-align:right"><code>ast</code> → csstree parsed object, <br> <code>sheet</code> → object that contains text and ast</td>
</tr>
<tr>
<td><code>onUrl(urlNode)</code></td>
<td style="text-align:center">runs any time a CSS URL is parsed</td>
<td style="text-align:right"><code>urlNode</code> → url origin</td>
</tr>
<tr>
<td><code>onAtPage(atPageNode)</code></td>
<td style="text-align:center">runs any time a CSS @page is parsed</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td><code>onRule(ruleNode)</code></td>
<td style="text-align:center">runs any time a CSS rule is parsed</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td><code>onDeclaration(declaration, dItem, dList, rule)</code></td>
<td style="text-align:center">runs any time a CSS declaration is parsed</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td><code>onContent(contentNode, declarationNode, ruleNode)</code></td>
<td style="text-align:center">run every time a css content property is found</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h4 id="layout" tabindex="-1">Layout</h4>
<table>
<thead>
<tr>
<th>Hook</th>
<th style="text-align:center">Hooks order</th>
<th style="text-align:right">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>layoutNode(node)</code></td>
<td style="text-align:center">When a node is layed out <br> (Tips: layoutNode is the original node from the content)</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td><code>renderNode(node, sourceNode)</code></td>
<td style="text-align:center">When a node is rendered <br> (Tips: renderNode is the cloned node that is added to the DOM)</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td><code>onOverflow(overflow, rendered, bounds)</code></td>
<td style="text-align:center">When an element overflows: when it’s bigger than the remaining space on the page</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td><code>onBreakToken(breakToken, overflow, rendered)</code></td>
<td style="text-align:center">When a breakToken is defined</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h2 id="some-examples" tabindex="-1">Some examples</h2>
<h3 id="cleaning-hyperlinks-for-the-print" tabindex="-1">cleaning hyperlinks for the print</h3>
<p>HTML5 has this unknown element called <code>wbr</code> which represents a line break opportunity, which you can translate into “I don’t have enough space to put the line of text, but thanksfully, i have those small element that i can cut!” Using this, we wouldn’t have any problem with line flowing outside of the page, or arbitrary cuts in the text that we want to avoid. Exactly what we need.</p>
<p>So let’s say that we have some written down hyperlinks that we want to clean and make ready for printing. Let’s create a new Paged.Handler</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">linkCleaning</span> <span class="token keyword">extends</span> <span class="token class-name">Paged<span class="token punctuation">.</span>Handler</span> <span class="token punctuation">{</span><br>  <span class="token comment">// this let us call the methods from the the chunker, the polisher and the caller for the rest of the script</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">chunker<span class="token punctuation">,</span> polisher<span class="token punctuation">,</span> caller</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span>chunker<span class="token punctuation">,</span> polisher<span class="token punctuation">,</span> caller<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">beforeParsed</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">//   Before the content is parsed by Paged.js, please do the follwing:</span><br><br>    <span class="token comment">// first, look for all the links &lt;a> that are referencing a link started by http or www</span><br>    <span class="token keyword">const</span> links <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'a[href^="http"], a[href^="www"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// for each of those links,</span><br>    links<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">link</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// Break after a colon or a double slash (//) or before a single slash (/), a tilde (~), a period, a comma, a hyphen, an underline (_), a question mark, a number sign, or a percent symbol.</span><br>      <span class="token keyword">const</span> content <span class="token operator">=</span> link<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span><br>      <span class="token keyword">let</span> printableUrl <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"//\u003Cwbr\u003E"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      printableUrl <span class="token operator">=</span> printableUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\,</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">",\u003Cwbr\u003E"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// put a &lt;wbr> element around to define where to break the line.</span><br>      printableUrl <span class="token operator">=</span> printableUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><br>        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\/|\~|\-|\.|\,|\_|\?|\#|\%)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><br>        <span class="token string">"\u003Cwbr\u003E$1"</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// turn hyphen in non breaking hyphen</span><br>      printableUrl <span class="token operator">=</span> printableUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"\u003Cwbr\u003E&amp;#x2011;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// add a data-print-url to keep track of the previous link</span><br>      link<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"data-print-url"</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// modify the inner text of the link</span><br>      link<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> printableUrl<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// and we don’t forget to register the handler like this</span><br><br>Paged<span class="token punctuation">.</span><span class="token function">registerHandlers</span><span class="token punctuation">(</span>linkCleaning<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Calling this script right after paged.js will run it before the content is parsed.</p>
<h3 id="adding-a-class-to-an-image-based-on-its-ratio" tabindex="-1">Adding a class to an image based on its ratio</h3>
<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">imageRatio</span> <span class="token keyword">extends</span> <span class="token class-name">Paged<span class="token punctuation">.</span>Handler</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">chunker<span class="token punctuation">,</span> polisher<span class="token punctuation">,</span> caller</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span>chunker<span class="token punctuation">,</span> polisher<span class="token punctuation">,</span> caller<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">afterParsed</span><span class="token punctuation">(</span><span class="token parameter">parsed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// create an array that will store the images data later on</span><br>    <span class="token keyword">let</span> imagePromises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token comment">// find all images parsed by paged.js</span><br>    <span class="token keyword">let</span> images <span class="token operator">=</span> parsed<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// for each image</span><br>    images<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// load the image as an object</span><br>      <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// test if the image is loaded</span><br>      <span class="token keyword">let</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">;</span><br>      <span class="token keyword">let</span> imageLoaded <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        resolve <span class="token operator">=</span> r<span class="token punctuation">;</span><br>        reject <span class="token operator">=</span> x<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// when the image loads</span><br>      img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// find its height</span><br>        <span class="token keyword">let</span> height <span class="token operator">=</span> img<span class="token punctuation">.</span>naturalHeight<span class="token punctuation">;</span><br><br>        <span class="token comment">// find its width</span><br>        <span class="token keyword">let</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>naturalWidth<span class="token punctuation">;</span><br><br>        <span class="token comment">// calculate the ratio</span><br>        <span class="token keyword">let</span> ratio <span class="token operator">=</span> width <span class="token operator">/</span> height<span class="token punctuation">;</span><br><br>        <span class="token comment">// if the ratio is superior than 1.4, set it as a lanscape adn add a class to the image (and to the parent figure)</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ratio <span class="token operator">>=</span> <span class="token number">1.4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          image<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"landscape"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          image<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"fig-landscape"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token comment">// if the ratio is inferior than 0.8, set it as a portrait adn add a class to the image (and to the parent figure)</span><br>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ratio <span class="token operator">&lt;=</span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          image<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"portrait"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          image<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"fig-portrait"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token comment">// else, if it’s between 1.39 and 0.8, add a “square” class.</span><br>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ratio <span class="token operator">&lt;</span> <span class="token number">1.39</span> <span class="token operator">||</span> ratio <span class="token operator">></span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          image<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"square"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          image<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"fig-square"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token comment">// resolve the promise</span><br>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      <span class="token comment">// if there is an error, reject the promise</span><br>      img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>      img<span class="token punctuation">.</span>src <span class="token operator">=</span> image<span class="token punctuation">.</span>src<span class="token punctuation">;</span><br><br>      imagePromises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>imageLoaded<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>imagePromises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// and we register the handler</span><br><br>Paged<span class="token punctuation">.</span><span class="token function">registerHandlers</span><span class="token punctuation">(</span>imageRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

  </article>
    

  
    
      
      
      <aside class="paginator ">
        <a class="previous" href="/documentation/-cross-references/">Cross References</a>
        
      </aside>



        
            <footer><p class="foot-content">Paged.js is maintained by the nice folks at
<a href="https://coko.foundation" class="footer-logo">Coko</a>.</p></footer>

        

        
        
        

        
        <script>

        if (document.querySelector('.toc .title')) {
        document.querySelector('.toc .title').addEventListener("click", function() {
        document.querySelector('.toc').classList.toggle("show");
        })
        }

        document.querySelector(".menu-call").addEventListener("click", function() {document.querySelector(".menu").classList.toggle("hide")});


        </script>
        
        <!-- 
        Donation nation
        -->

        <script>
        (function () {
        if (document.querySelector('.commitchange-donate[data-fixed]')) 
        return;
        var cc_donate = document.createElement('div');
        cc_donate.innerHTML = "<a data-fixed class='commitchange-donate'></a>";
        document
        .body
        .appendChild(cc_donate);
        var npo = 5726;
        var script = document.createElement('script');
        var first = document.getElementsByTagName('script')[0];
        script.setAttribute('data-npo-id', npo);
        script.id = 'commitchange-script';
        script.src = 'https://us.commitchange.com/js/donate-button.v2.js';
        first
        .parentNode
        .insertBefore(script, first);
        })();


        </script>
        </body>
        </html>
